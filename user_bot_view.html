<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ØªÙØ§ØµÙŠÙ„ Ø¨ÙˆØª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</title>
  <style>
    body { font-family: Tahoma, Arial; direction: rtl; background: #f4f4f9; margin: 20px; }
    h2 { text-align: center; color: #333; }
    .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    table th, table td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    table th { background-color: #0070ba; color: white; }
    button { padding: 6px 12px; border: none; border-radius: 5px; cursor: pointer; background-color: #28a745; color: white; }
  </style>
</head>
<body>
  <h2>ğŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨ÙˆØª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…</h2>
  <div class="card">
    <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> <span id="username">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
    <p><strong>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„:</strong> <span id="email">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
    <p><strong>ØªÙ„ÙŠØ¬Ø±Ø§Ù…:</strong> <span id="telegram_id">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
    <p><strong>Ø§Ù„Ø±ØµÙŠØ¯:</strong> <span id="balance">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
    <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª:</strong> <span id="bot-status">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
    <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ø±ÙˆØ¨Ø§Øª:</strong> <span id="groups-count">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
    <p><strong>ÙˆÙ‚Øª ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª:</strong> <span id="bot-timer">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
  </div>

  <div class="card">
    <h3>ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø±ÙˆØ¨Ø§Øª</h3>
    <table>
      <thead>
        <tr>
          <th>Ø§Ø³Ù… Ø§Ù„Ø¬Ø±ÙˆØ¨</th>
          <th>Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</th>
        </tr>
      </thead>
      <tbody id="groupsBody">
        <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø±ÙˆØ¨Ø§Øª ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
      </tbody>
    </table>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getFirestore, doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

    // ğŸ”¹ Ø¥Ø¹Ø¯Ø§Ø¯ Firebase Ø§Ù„Ø®Ø§Øµ Ø¨ÙŠÙƒ
    const firebaseConfig = {
      apiKey: "AIzaSyBGFMZtSytIPzF4XYLyA34DpF5q_k-UPL8",
      authDomain: "fir-dba4c.firebaseapp.com",
      projectId: "fir-dba4c",
      storageBucket: "fir-dba4c.firebasestorage.app",
      messagingSenderId: "160255207915",
      appId: "1:160255207915:web:ce8e69d43f62daf476d1ae",
      measurementId: "G-GYPNMR85G2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const urlParams = new URLSearchParams(window.location.search);
    const uid = urlParams.get('uid');

    const usernameEl = document.getElementById("username");
    const emailEl = document.getElementById("email");
    const telegramEl = document.getElementById("telegram_id");
    const balanceEl = document.getElementById("balance");
    const botStatusEl = document.getElementById("bot-status");
    const groupsCountEl = document.getElementById("groups-count");
    const groupsBody = document.getElementById("groupsBody");
    const botTimerEl = document.getElementById("bot-timer");

    let timerSeconds = 0;
    let timerInterval;

    async function loadUserBotData() {
      const userDoc = await getDoc(doc(db, "users", uid));
      if (!userDoc.exists()) return alert("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!");

      const userData = userDoc.data();
      usernameEl.textContent = userData.username || "-";
      emailEl.textContent = userData.email || "-";
      telegramEl.textContent = userData.telegram_id || "-";
      balanceEl.textContent = userData.balance || 0;
      botStatusEl.textContent = userData.botActive ? "âœ… Ù…ÙØ¹Ù„" : "âŒ Ù…ØªÙˆÙ‚Ù";

      // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø±ÙˆØ¨Ø§Øª
      const groupsCol = collection(db, `users/${uid}/groups`);
      const groupsSnap = await getDocs(groupsCol);
      groupsBody.innerHTML = "";
      groupsCountEl.textContent = groupsSnap.size;

      groupsSnap.forEach(docSnap => {
        const group = docSnap.data();
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${group.name || "-"}</td>
          <td>${group.data || "-"}</td>
        `;
        groupsBody.appendChild(row);
      });

      // Ø¨Ø¯Ø¡ Ø¹Ø¯Ø§Ø¯ ÙˆÙ‚Øª ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
      if(userData.botActive) startBotTimer();
    }

    function startBotTimer() {
      timerInterval = setInterval(() => {
        timerSeconds++;
        const hrs = Math.floor(timerSeconds / 3600);
        const mins = Math.floor((timerSeconds % 3600) / 60);
        const secs = timerSeconds % 60;
        botTimerEl.textContent = `${hrs}Ø³ ${mins}Ø¯ ${secs}Ø«`;
      }, 1000);
    }

    loadUserBotData();
  </script>
</body>
</html>